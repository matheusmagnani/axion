generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum AssociateStatus {
  ACTIVE
  INACTIVE
  PENDING
}

enum ContractStatus {
  ACTIVE
  ENDED
  CANCELLED
  PENDING
}

enum BillingStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

// Models
model Associate {
  id        Int             @id @default(autoincrement())
  name      String
  cpf       String          @unique
  email     String          @unique
  phone     String
  status    AssociateStatus @default(PENDING)
  createdAt DateTime        @default(now()) @map("created_at")
  updatedAt DateTime        @updatedAt @map("updated_at")

  contracts Contract[]
  billings  Billing[]

  @@map("associates")
}

model Contract {
  id          Int            @id @default(autoincrement())
  number      String         @unique
  description String?
  value       Decimal        @db.Decimal(10, 2)
  startDate   DateTime       @map("start_date")
  endDate     DateTime?      @map("end_date")
  status      ContractStatus @default(PENDING)

  associateId Int       @map("associate_id")
  associate   Associate @relation(fields: [associateId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  billings Billing[]

  @@map("contracts")
}

model Billing {
  id          Int           @id @default(autoincrement())
  description String
  value       Decimal       @db.Decimal(10, 2)
  dueDate     DateTime      @map("due_date")
  paymentDate DateTime?     @map("payment_date")
  status      BillingStatus @default(PENDING)

  associateId Int       @map("associate_id")
  associate   Associate @relation(fields: [associateId], references: [id])

  contractId Int?      @map("contract_id")
  contract   Contract? @relation(fields: [contractId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("billings")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  active    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}
